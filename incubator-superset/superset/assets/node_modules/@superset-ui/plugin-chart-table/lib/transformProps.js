"use strict";exports.__esModule=!0,exports.default=transformProps;var _processColumns=_interopRequireDefault(require("./processColumns")),_processMetrics=_interopRequireDefault(require("./processMetrics")),_processData=_interopRequireDefault(require("./processData"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var DTTM_ALIAS="__timestamp";function transformData(a,b){var c=b.groupby,d=void 0===c?[]:c,e=b.metrics,f=void 0===e?[]:e,g=b.allColumns,h=void 0===g?[]:g,i=new Set([].concat(d,f,h).map(function(a){return a.label||a})),j=a;b.includeTime&&i.add(DTTM_ALIAS);// handle percentage columns.
var k=(b.percentMetrics||[]).map(function(a){return a.label||a});if(0<k.length){var l=a.reduce(function(a,b){var c=_extends({},a);return k.forEach(function(d){c[d]=(a[d]||0)+(b[d]||0)}),c},{});j=a.map(function(a){var b=_extends({},a);return k.forEach(function(a){b["%"+a]=0===l[a]?null:b[a]/l[a]}),b}),k.forEach(function(a){i.add("%"+a)})}// handle sortedby column
if(b.timeseriesLimitMetric){var m=b.timeseriesLimitMetric.label||b.timeseriesLimitMetric;i.add(m)}return{columns:[].concat(i),records:j}}var NOOP=function(){};function transformProps(a){var b=a.height,c=a.datasource,d=a.initialValues,e=a.formData,f=a.hooks,g=a.queryData,h=f.onAddFilter,i=void 0===h?NOOP:h,j=e.alignPn,k=e.colorPn,l=e.includeSearch,m=e.metrics,n=e.orderDesc,o=e.pageLength,p=e.percentMetrics,q=e.tableFilter,r=e.tableTimestampFormat,s=e.timeseriesLimitMetric,t=transformData(g.data,e),u=t.records,v=t.columns,w=(0,_processMetrics.default)({metrics:m,percentMetrics:p,records:u}),x=(0,_processData.default)({metrics:w,orderDesc:n,records:u,timeseriesLimitMetric:s}),y=(0,_processColumns.default)({columns:v,datasource:c,metrics:w,records:u,tableTimestampFormat:r});return{alignPositiveNegative:j,colorPositiveNegative:k,columns:y,data:x,filters:d,height:b,includeSearch:l,onAddFilter:i,orderDesc:n,pageLength:o&&parseInt(o,10),tableFilter:q}}