function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import React from 'react';
import PropTypes from 'prop-types';
import { and, mutuallyExclusiveProps, forbidExtraProps } from 'airbnb-prop-types';
import withStyles from '../../composers/withStyles';
const mutuallyExclusiveSizePropType = mutuallyExclusiveProps(PropTypes.any, 'small', 'large', 'macro', 'size');
const namedSizePropType = and([PropTypes.bool, mutuallyExclusiveSizePropType]);
const unitSizePropType = and([PropTypes.number, mutuallyExclusiveSizePropType]);

/** Display a profile photo. */
export class ProfilePhoto extends React.Component {
  constructor() {
    super(...arguments);

    _defineProperty(this, "state", {
      src: this.props.imageSrc || ''
    });

    _defineProperty(this, "handleError", event => {
      const {
        fallbackImageSrc
      } = this.props;

      if (fallbackImageSrc) {
        this.setState({
          src: fallbackImageSrc
        });
      }
    });
  }

  componentDidUpdate(prevProps) {
    const {
      imageSrc
    } = this.props;

    if (imageSrc !== prevProps.imageSrc) {
      this.setState({
        src: imageSrc
      });
    }
  }

  render() {
    const {
      src
    } = this.state;
    const {
      cx,
      fallbackImageSrc,
      inline,
      macro,
      large,
      small,
      size,
      square,
      styles,
      title,
      theme
    } = this.props;
    const {
      unit
    } = theme;
    return React.createElement("div", {
      className: cx(inline && styles.inline, styles.regular, macro && styles.macro, large && styles.large, small && styles.small, !!size && size > 0 && {
        height: size * unit,
        maxHeight: size * unit,
        maxWidth: size * unit,
        width: size * unit
      })
    }, React.createElement("img", {
      className: cx(styles.image, styles.regular, !square && styles.roundedImage, macro && styles.macro, large && styles.large, small && styles.small, !!size && size > 0 && {
        height: size * unit,
        maxHeight: size * unit,
        maxWidth: size * unit,
        width: size * unit
      }),
      src: src,
      alt: title,
      title: title,
      onError: fallbackImageSrc ? this.handleError : undefined
    }));
  }

}

_defineProperty(ProfilePhoto, "propTypes", {
  title: PropTypes.string.isRequired,
  square: PropTypes.bool,
  inline: PropTypes.bool,
  imageSrc: PropTypes.string.isRequired,
  fallbackImageSrc: PropTypes.string,
  large: namedSizePropType,
  macro: namedSizePropType,
  size: unitSizePropType,
  small: namedSizePropType
});

_defineProperty(ProfilePhoto, "defaultProps", {
  inline: false,
  square: false
});

export default withStyles((_ref) => {
  let {
    color
  } = _ref;
  return {
    inline: {
      display: 'inline-block'
    },
    image: {
      display: 'block',
      background: color.core.neutral[6],
      color: color.base,
      objectFit: 'cover',
      overflow: 'hidden'
    },
    roundedImage: {
      borderRadius: '50%'
    },
    small: {
      height: 24,
      width: 24,
      maxHeight: 24,
      maxWidth: 24
    },
    regular: {
      height: 48,
      width: 48,
      maxHeight: 48,
      maxWidth: 48
    },
    large: {
      height: 96,
      width: 96,
      maxHeight: 96,
      maxWidth: 96
    },
    macro: {
      height: 160,
      width: 160,
      maxHeight: 160,
      maxWidth: 160
    }
  };
}, {
  passThemeProp: true
})(ProfilePhoto);