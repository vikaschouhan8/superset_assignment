"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = fetchFromCDN;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

function fetchFromCDN(path) {
  var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'latest';
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  if ("production" !== process.env.NODE_ENV) {
    if (!path || path.slice(-5) !== '.json') {
      throw new Error('A valid JSON dataset is required to fetch.');
    }

    if (!version) {
      throw new Error('A valid release version is required.');
    }
  }

  var _options$local = options.local,
      local = _options$local === void 0 ? false : _options$local,
      opts = (0, _objectWithoutProperties2.default)(options, ["local"]);
  var storage = local ? localStorage : sessionStorage;
  var cacheKey = "emojibase/".concat(version, "/").concat(path);
  var cachedData = storage.getItem(cacheKey);

  if (cachedData) {
    try {
      return Promise.resolve(JSON.parse(cachedData));
    } catch (error) {
      return Promise.resolve([]);
    }
  }

  return fetch("https://cdn.jsdelivr.net/npm/emojibase-data@".concat(version, "/").concat(path), (0, _objectSpread2.default)({
    credentials: 'omit',
    mode: 'cors',
    redirect: 'error'
  }, opts)).then(function (response) {
    if (!response.ok) {
      throw new Error('Failed to load Emojibase dataset.');
    }

    return response.json();
  }).then(function (data) {
    try {
      storage.setItem(cacheKey, JSON.stringify(data));
    } catch (error) {}

    return data;
  });
}